---


- name: config-list.set|set config_list
  loop: "{{ list.all | dict2items | selectattr('key','in',list.select) }}"
  loop_control:
    loop_var: kv
  vars:
    config:
      name: "{{ kv.key }}"
    config_item: "{{ kv.value | combine(config, recursive=True) }}"
  ansible.builtin.set_fact:
    _list: "{{ _list | default([]) + [config_item] }}"

- debug: msg="{{ _list }}" verbosity=3

- name: config-list.set|reset _list
  ansible.builtin.set_fact:
    "{{ list.register | default('config_list') }}": "{{ _list }}"
    _list: !!null
