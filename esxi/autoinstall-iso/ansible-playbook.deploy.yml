---


- name: deploy
  vars:
    run_wsl: |
      ansible-playbook \
        --ask-become-pass \
        --inventory $PWD/ansible/inventory-local.yml \
        $PWD/../../../esxi/autoinstall-iso/ansible-playbook.deploy.yml
  vars_prompt:
    - name: vm_username
      prompt: "What is ESXi/vCenter server username?"
      private: no
      default: 
    - name: vm_password
      prompt: "What is ESXi/vCenter server password?"
      private: yes
      default: 
    - name: vm_name
      prompt: "What is vm or group?"
      private: no
      default: all
  hosts: localhost
  tasks: 

    - include_tasks: "{{ playbook_dir }}/../ansible-tasks/vm-group.set.yml"
      vars:
        group:
          name: "{{ vm_name }}"
          all: "{{ esxi.group }}"

    - include_tasks: "{{ playbook_dir }}/../ansible-tasks/vm-list.set.yml"
      vars:
        list:
          select: "{{ vm_group }}"
          all: "{{ esxi.vm }}"

    - debug: msg="{{ vm_list | selectattr('autoinstall','defined') | map(attribute='autoinstall') }}"

    - include_tasks: "{{ playbook_dir }}/ansible-tasks.deploy.yml"
      vars:
        autoinstall:
          select: "{{ vm_list | selectattr('autoinstall','defined') | map(attribute='autoinstall') }}"
          all: "{{ esxi.autoinstall }}"
