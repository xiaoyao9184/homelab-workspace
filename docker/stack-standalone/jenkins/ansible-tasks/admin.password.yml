---


- name: admin.password
  block:

    - name: admin.password|set _jenkins
      ansible.builtin.set_fact:
        _jenkins:
          service: "{{ jenkins.service }}"
          workspace: "{{ jenkins.workspace }}"

    - name: admin.password|set _jenkins.service.result
      ansible.builtin.set_fact:
        _jenkins: "{{ _jenkins | combine(update, recursive=True) }}"
      vars:
        update:
          service:
            result: jenkins_passwd

    - name: admin.password|exec cat admin password
      include_tasks: "{{ _jenkins.workspace }}/.seed/ansible-tasks/docker-service.exec.yml"
      vars:
        service: "{{ _jenkins.service }}"

    - name: admin.password|set _jenkins.result
      ansible.builtin.set_fact:
        _jenkins: "{{ _jenkins | combine(update, recursive=True) }}"
      vars:
        update:
          result: "{{ jenkins_passwd }}"

    - name: admin.password|print _jenkins
      debug:
        var: _jenkins

    - name: admin.password|reset _jenkins
      ansible.builtin.set_fact:
        _jenkins: !!null

  rescue:

    - name: admin.password|retry 15 seconds
      pause:
        seconds: 15

    - include_tasks: "admin.password.yml"