---


- name: headscale set node
  ansible.builtin.set_fact:
    node:
      namespace: "{{ _node.namespace | default('default') }}"
      key: "{{ _node.key }}" 
      container_id: "{{ _node.container_id }}"

- name: headscale register node
  community.docker.docker_container_exec:
    container: "{{ node.container_id }}"
    command: "headscale -n {{ node.namespace }} nodes register --key {{ node.key }}"
  register: node_result

- name: headscale set node.result
  ansible.builtin.set_fact:
    node: "{{ node | combine(update, recursive=True) }}"
  vars:
    update:
      result: "{{ node_result.stdout }}"

- name: headscale print node
  debug:
    var: node

- name: headscale reset node_result
  ansible.builtin.set_fact:
    node_result: !!null