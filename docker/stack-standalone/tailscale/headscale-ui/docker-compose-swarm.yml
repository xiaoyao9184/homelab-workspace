version: "3.7"

configs:
  stack_cfg-Caddyfile:
    file: ./config/Caddyfile

networks:
  external_net-headscale:
    external: true

services:
  headscale-ui:
    image: ghcr.io/gurucomputing/headscale-ui:latest
    environment:
      - HTTP_PORT=80
      - HTTPS_PORT=443
    configs:
      - source: stack_cfg-Caddyfile
        target: /data/Caddyfile
    ports:
      - 9443:443
      - 8888:80
    networks:
      - external_net-headscale
    deploy:
      replicas: 1
      placement:
        constraints: 
          - node.platform.os == linux
      update_config:
        parallelism: 2
        delay: 10s
      restart_policy:
        condition: on-failure
