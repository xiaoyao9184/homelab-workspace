---

- name: set fact for docker-seed-local
  when: 
    - lookup('ansible.builtin.env', 'SEED_NAME') != ''
    - ansible_connection == 'local'
  ansible.builtin.set_fact:
    seed_in_docker_connect_local: true

- name: set copy_nfs:is docker-seed-local 
  when: 
    - wait_nfs.server is defined
    - wait_nfs.point is defined
    - seed_in_docker_connect_local is defined
  ansible.builtin.set_fact:
    copy_nfs_point: "{{ wait_nfs.server.host }}:{{ wait_nfs.point }}"

- name: set copy_nfs:not docker-seed-local
  when: 
    - wait_nfs.server is defined
    - wait_nfs.point is defined
    - seed_in_docker_connect_local is undefined
  ansible.builtin.set_fact:
    copy_nfs_point: "{{ wait_nfs.server.addr }}:{{ wait_nfs.point }}"

- name: mkdir copy_nfs.dest
  ansible.builtin.file:
    path: "{{ copy_nfs.dest }}"
    state: directory
    mode: 0777
    owner: root
    group: root

- name: mount copy_nfs_point
  when: 
    - copy_nfs_point is defined
    - copy_nfs.dest is defined
  ansible.posix.mount:
    src: "{{ copy_nfs_point }}"
    path: "{{ copy_nfs.dest }}"
    fstype: nfs
    opts: "vers=4,loud,rw,sync"
    state: mounted

- name: copy copy_nfs.src
  ansible.builtin.copy:
    src: "{{ copy_nfs.src }}/"
    dest: "{{ copy_nfs.dest }}"