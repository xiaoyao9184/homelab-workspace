---


- name: add connector to debezium
  community.docker.docker_container:
    name: "add-connector.{{ add_name }}"
    state: started
    image: debezium/tooling:latest
    command: "curl -i -X POST -H 'Accept:application/json' -H 'Content-Type:application/json' -d @/connector/{{ add_file }} connect:8083/connectors/"
    networks: "{{ add_network | map('community.general.dict_kv', 'name') }}"
    volumes:
      - "{{ add_volume }}:/connector"
    labels:
      "com.docker.stack.namespace": seed
      "com.github.xiaoyao9184.docker-seed.type": "debezium-container.add"
      "com.github.xiaoyao9184.docker-seed.creator": "{{ lookup('ansible.builtin.env', 'SEED_NAME', default='debezium-container.add') }}"
  register: result_connector_debezium
  until: "result_connector_debezium is not failed"
  retries: 1000
  delay: 10