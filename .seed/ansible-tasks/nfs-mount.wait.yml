---


- name: set fact for docker-seed-local
  when: 
    - lookup('ansible.builtin.env', 'SEED_NAME') != ''
    - ansible_connection == 'local'
  ansible.builtin.set_fact:
    seed_in_docker_connect_local: true

- name: set loop_nfs:is docker-seed-local 
  when: seed_in_docker_connect_local is defined
  ansible.builtin.set_fact:
    loop_nfs:
      point: "{{ wait_nfs.server.host }}:{{ wait_nfs.point }}"
      mount: "{{ wait_nfs.mount }}"
      remove: "{{ wait_nfs.remove | default(false) }}"

- name: set loop_nfs:not docker-seed-local
  when: seed_in_docker_connect_local is undefined
  ansible.builtin.set_fact:
    loop_nfs:
      point: "{{ wait_nfs.server.addr }}:{{ wait_nfs.point }}"
      mount: "{{ wait_nfs.mount }}"
      remove: "{{ wait_nfs.remove | default(false) }}"

- name: print loop_nfs
  ansible.builtin.debug:
    var: loop_nfs

- name: mkdir wait_nfs.mount
  ansible.builtin.file:
    path: "{{ wait_nfs.mount }}"
    state: directory
    mode: 0777
    owner: root
    group: root

- name: loop nfs
  include_tasks: "{{ ws_path }}/.seed/ansible-tasks/nfs-mount.loop.yml"

- name: rm wait_nfs.mount
  when: 
    - wait_nfs.remove is defined
    - wait_nfs.remove
  ansible.builtin.file:
    path: "{{ wait_nfs.mount }}"
    state: absent
