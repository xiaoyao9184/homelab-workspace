---


- name: add
  vars:
    run_wsl: |
      ansible-playbook \
        --ask-pass \
        --inventory $PWD/ansible \
        $PWD/../../../windows/port-range/exclude/ansible-playbook.add.yml
  hosts: windows
  tasks: 

    - include_tasks: "{{ playbook_dir }}/../../../.seed/ansible-tasks/list-group.select.yml"
      vars:
        group:
          data: "{{ port_range }}"
          select: "exclude"
          register: "_ports"

    - name: add ipv4 excluded port range
      loop: "{{ _ports }}"
      ansible.windows.win_command: |
        netsh int ipv4 add excludedportrange protocol={{ item.protocol }} startport={{ item.start }} numberofports={{ item.number }} store={{ item.store }}
      ignore_errors: true

    - name: add ipv6 excluded port range
      loop: "{{ _ports }}"
      ansible.windows.win_command: |
        netsh int ipv6 add excludedportrange protocol={{ item.protocol }} startport={{ item.start }} numberofports={{ item.number }} store={{ item.store }}
      ignore_errors: true
