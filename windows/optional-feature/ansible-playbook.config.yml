---


- name: config
  vars:
    run_wsl: |
      ansible-playbook \
        --ask-pass \
        --inventory $PWD/ansible-inventories \
        $PWD/../../../windows/optional-feature/ansible-playbook.config.yml
  vars_prompt:
    - name: group_name
      prompt: "What is optional_features group[default all group]?"
      private: no
      default: all
  hosts: windows
  tasks: 

    - include_tasks: "{{ playbook_dir }}/../../.seed/ansible-tasks/config-group.set.yml"
      vars:
        group:
          name: "{{ group_name }}"
          all: "{{ optional_features }}"
          default: "{{ optional_features.values() | flatten(1) }}"
          register: _features

    - name: enable optional feature
      loop: "{{ _features }}"
      vars:
        _default:
          state: present
        _win_optional_feature: "{{ item | combine(_default, recursive=True) }}"
      ansible.windows.win_optional_feature: "{{ _win_optional_feature }}"
      register: config_result
      until: "config_result is not failed"
      retries: 3
      delay: 5
